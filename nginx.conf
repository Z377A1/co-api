events {
    worker_connections 1024;
}

http {
    upstream rust_api {
        server rust-api:8001;
    }

    upstream go_api {
        server go-api:8002;
    }

    upstream bun_api {
        server bun-api:8003;
    }

    upstream java_api {
        server java-api:8004;
    }

    upstream csharp_api {
        server csharp-api:8005;
    }

    upstream kotlin_api {
        server kotlin-api:8006;
    }

    server {
        listen 80;
        server_name localhost;

        # Root endpoint
        location / {
            return 200 'Cinematic Order API Ecosystem\nAccess endpoints at /api/*\n\nServices:\n- Owners (Rust): /api/owners\n- Franchises (Go): /api/franchises\n- Movies (Bun): /api/movies\n- Box Office (Java): /api/boxoffice\n- Cast (C#): /api/cast\n- Images (Kotlin): /api/images';
            add_header Content-Type text/plain;
        }

        # Owner API (Rust/Axum)
        location /api/owners/health {
            proxy_pass http://rust_api/health;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location /api/owners {
            proxy_pass http://rust_api/api/owners;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Franchise API (Go/Gin)
        location /api/franchises/health {
            proxy_pass http://go_api/health;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location /api/franchises {
            proxy_pass http://go_api/api/franchises;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Movie API (Bun/Serve)
        location /api/movies/health {
            proxy_pass http://bun_api/api/movies/health;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location /api/movies {
            proxy_pass http://bun_api/api/movies;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Box Office API (Java/Spring)
        location /api/boxoffice/health {
            proxy_pass http://java_api/api/boxoffice/health;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location /api/boxoffice {
            proxy_pass http://java_api/api/boxoffice;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Cast member API (C#/Minimal API)
        location /api/cast-members/health {
            proxy_pass http://csharp_api/health;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location /api/cast-members {
            proxy_pass http://csharp_api/api/cast;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Image API (Kotlin/Spring)
        location /api/images/health {
            proxy_pass http://kotlin_api/api/images/health;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location /api/images {
            proxy_pass http://kotlin_api/api/images;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }
}